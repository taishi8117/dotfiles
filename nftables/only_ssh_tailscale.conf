#!/usr/sbin/nft -f

flush ruleset

table inet filter {
  chain input {
    type filter hook input priority 0; policy drop;

    # allow loopback
    iif lo accept

    # replies to outbound traffic
    ct state established,related accept

    # SSH from anywhere (tighten later if you want)
    tcp dport 22 accept

    # allow all traffic on Tailscale interface (preferred)
    iifname "tailscale0" accept

    # Optional: allow raw Tailscale UDP port as a fallback bootstrap path
    # (Tailscale can roam ports; this helps if tailscale0 isn't up yet.)
    udp dport 41641 accept
  }

  chain forward {
    type filter hook forward priority 0; policy drop;
  }

  chain output {
    type filter hook output priority 0; policy accept;
  }
}

